# Generated by iptables-save
*filter
:INPUT ACCEPT [0:0]
:FORWARD DROP [0:0]
:OUTPUT ACCEPT [0:0]

# Allow loopback
-A INPUT -i lo -j ACCEPT

# Allow established/related connections
-A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT

# Allow ICMP (ping) from any interface
-A INPUT -p icmp -j ACCEPT

# Allow SSH only on primary interface
-A INPUT -i {{ primary_nic }} -p tcp --dport 22 -j ACCEPT

# Allow HTTP only on primary interface
-A INPUT -i {{ primary_nic }} -p tcp --dport 80 -j ACCEPT

# Allow HTTPS only on primary interface
-A INPUT -i {{ primary_nic }} -p tcp --dport 443 -j ACCEPT

# Drop everything else
-A INPUT -j DROP

{% if internal_nic_ip != '' and secondary_nic is defined and secondary_nic != '' %}
# FORWARD chain rules
# Deny IP forwarding between primary and secondary NICs (both directions)
-A FORWARD -i {{ primary_nic }} -o {{ secondary_nic }} -j DROP
-A FORWARD -i {{ secondary_nic }} -o {{ primary_nic }} -j DROP

{% endif %}
COMMIT
